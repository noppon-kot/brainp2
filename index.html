<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Training Game</title>
    <style>
         body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 20px; 
            transition: background-color 0.5s ease-in-out; 
        }
        .correct { 
            background-color: green !important; 
        }
        .incorrect { 
            background-color: red !important; 
        }
        .hidden { display: none; }
        .numbers { font-size: 20px; font-weight: bold; color: blue; margin: 20px 0; white-space: pre-line; }
        .score, .time { font-size: 18px; margin: 10px 0; }
        #answer { font-size: 20px; width: 80px; padding: 10px; text-align: center; }
        button { padding: 10px 20px; font-size: 16px; margin-top: 20px; }
        .button-group { display: flex; justify-content: center; gap: 10px; }
        table {
            margin-top: 20px;
            width: auto; /* ขนาดตารางจะพอดีกับเนื้อหา */
            border-collapse: collapse; /* รวมขอบของตารางให้เป็นเส้นเดียว */
            margin-left: auto; /* จัดให้ตารางอยู่กลาง */
            margin-right: auto; /* จัดให้ตารางอยู่กลาง */
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid black; /* เปลี่ยนสีขอบเป็นสีดำ */
        }

        th {
            background-color: #cccccc;
        }
        .correct { background-color: #c8e6c9; } /* สีเขียว */
        .incorrect { background-color: #f8d7da; } /* สีแดงอ่อน */
    </style>
</head>
<body>
    <h1>BrainTraining P2</h1>
    <div id="questionNumber" class="score hidden">Question: 1</div>
    <div id="score" class="score hidden">Score: 0/0</div>
    <div id="time" class="time hidden">Time: 00:00</div>
    <div id="numbers" class="numbers hidden"></div>
    <input id="answer" class="hidden" type="text" placeholder="Enter answer" />
    <div class="button-group">
        <button id="startButton">Start</button>
        <button id="stopButton" class="hidden">Stop</button>
        <button id="enterButton" class="hidden">Enter</button>
    </div>

    <table id="answersTable" class="hidden">
        <thead>
            <tr>
                <th>#</th>
                <th>Numbers</th>
                <th>Correct Answer</th>
                <th>Your Answer</th>
            </tr>
        </thead>
        <tbody id="answersBody">
        </tbody>
    </table>

    <script>
        let currentQuestion = 0;
        let correctAnswers = 0;
        let totalQuestions = 50;
        let timeSeconds = 0;
        let timerRunning = false;
        let generatedNumbers = [];
        let timer;
        const answers = [];

        const startButton = document.getElementById("startButton");
        const stopButton = document.getElementById("stopButton");
        const enterButton = document.getElementById("enterButton");
        const answerInput = document.getElementById("answer");
        const scoreLabel = document.getElementById("score");
        const timeLabel = document.getElementById("time");
        const numbersLabel = document.getElementById("numbers");
        const questionNumberLabel = document.getElementById("questionNumber");
        const answersTable = document.getElementById("answersTable");
        const answersBody = document.getElementById("answersBody");

        startButton.addEventListener("click", startGame);
        stopButton.addEventListener("click", stopGame);
        enterButton.addEventListener("click", checkAnswerClick);
        answerInput.addEventListener("keydown", checkAnswerKey);

        function flashBackground(className) {
            document.body.classList.add(className);
            setTimeout(() => {
                document.body.classList.remove(className);
            }, 500);
        }

        function startGame() {
            currentQuestion = 0;
            correctAnswers = 0;
            timeSeconds = 0;
            timerRunning = true;
            scoreLabel.textContent = `Score: ${correctAnswers}/${totalQuestions}`;
            timeLabel.textContent = "Time: 00:00";
            questionNumberLabel.textContent = `Question: ${currentQuestion + 1}`;

            startButton.classList.add("hidden");
            stopButton.classList.remove("hidden");
            enterButton.classList.remove("hidden");
            answerInput.classList.remove("hidden");
            scoreLabel.classList.remove("hidden");
            timeLabel.classList.remove("hidden");
            questionNumberLabel.classList.remove("hidden");
            numbersLabel.classList.remove("hidden");
            answersTable.classList.add("hidden"); // ซ่อนตารางเมื่อเริ่มเกม
            answerInput.value = "";
            answerInput.focus();

            timer = setInterval(updateTime, 1000);

            showNextQuestion();
        }

        function showNextQuestion() {
            if (currentQuestion >= totalQuestions) {
                numbersLabel.textContent = "Game End!";
                scoreLabel.textContent = `Your Score: ${correctAnswers}/${totalQuestions}`;
                timeLabel.textContent = `Time: ${formatTime(timeSeconds)}`;
                answerInput.classList.add("hidden");
                enterButton.classList.add("hidden");
                startButton.classList.remove("hidden");
                answersTable.classList.remove("hidden"); // Show table only after game ends
                clearInterval(timer);
                return;
            }

            generatedNumbers = [];
            let totalSum = 0;

            if (currentQuestion < totalQuestions / 2) {
                for (let i = 0; i < 8; i++) {
                    let num = randomInt(1, 9);
                    if (totalSum === 9) {
                        num = randomInt(-8, -1);
                    } else if (totalSum + num > 9) {
                        while (totalSum + num > 9) {
                            num = randomInt(1, 9);
                        }
                    }
                    generatedNumbers.push(num);
                    totalSum += num;
                }
            } else {
                for (let i = 0; i < 8; i++) {
                    let num = randomInt(1, 9);
                    if (i === 4 || i === 7 || totalSum > 30 ) {
                        num = randomInt(-9, -1);
                    } else if (totalSum + num < 0) {
                        while (totalSum + num < 0) {
                            num = randomInt(1, 9);
                        }

                        while (totalSum > 30 ) {
                            randomInt(-9, -1);
                        }
                    }
                    generatedNumbers.push(num);
                    totalSum += num;
                }
            }

            const formattedNumbers = generatedNumbers.map(num => num.toString().padStart(3, ' '));
            numbersLabel.textContent = formattedNumbers.join("\n");

            answerInput.value = "";
            answerInput.focus();
            questionNumberLabel.textContent = `Question: ${currentQuestion + 1}`;
            currentQuestion++;
        }


        function checkAnswerKey(event) {
            if (event.key === "Enter") {
                processAnswer();
            }
        }

        function checkAnswerClick() {
            processAnswer();
        }

        function processAnswer() {
            const userAnswer = parseInt(answerInput.value);
            if (isNaN(userAnswer)) {
                return;
            }
            const correctAnswer = generatedNumbers.reduce((a, b) => a + b, 0);
            const isCorrect = userAnswer === correctAnswer;

            // เพิ่มคะแนนเมื่อคำตอบถูกต้อง
            if (isCorrect) {
                correctAnswers++;
                flashBackground("correct");
            }else {
                flashBackground("incorrect");
            }

            // เก็บข้อมูลการตอบของผู้ใช้
            answers.push({
                question: currentQuestion,
                numbers: generatedNumbers.join(", "),
                correctAnswer: correctAnswer,
                userAnswer: userAnswer,
                isCorrect: isCorrect
            });

            // แสดงข้อมูลในตาราง
            const row = document.createElement("tr");
            row.classList.add(isCorrect ? "correct" : "incorrect");

            const tdQuestion = document.createElement("td");
            tdQuestion.textContent = currentQuestion;
            const tdNumbers = document.createElement("td");
            tdNumbers.textContent = generatedNumbers.join(", ");
            const tdCorrectAnswer = document.createElement("td");
            tdCorrectAnswer.textContent = correctAnswer;
            const tdUserAnswer = document.createElement("td");
            tdUserAnswer.textContent = userAnswer;

            row.appendChild(tdQuestion);
            row.appendChild(tdNumbers);
            row.appendChild(tdCorrectAnswer);
            row.appendChild(tdUserAnswer);
            answersBody.appendChild(row);

            // อัปเดตคะแนนทันที
            scoreLabel.textContent = `Score: ${correctAnswers}/${totalQuestions}`;

            showNextQuestion();
        }


        function updateTime() {
            if (timerRunning) {
                timeSeconds++;
                timeLabel.textContent = `Time: ${formatTime(timeSeconds)}`;
            }

            if (timeSeconds >= 420){
                numbersLabel.textContent = "Game End!";
                scoreLabel.textContent = `Your Score: ${correctAnswers}/${totalQuestions}`;
                timeLabel.textContent = `Time: ${formatTime(timeSeconds)}`;
                answerInput.classList.add("hidden");
                enterButton.classList.add("hidden");
                startButton.classList.remove("hidden");
                answersTable.classList.remove("hidden"); // Show table only after game ends
                clearInterval(timer);
                return;
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secondsLeft = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secondsLeft.toString().padStart(2, '0')}`;
        }

        function stopGame() {
            currentQuestion = 0;
            correctAnswers = 0;
            timeSeconds = 0;
            timerRunning = false;
            numbersLabel.textContent = "";
            scoreLabel.textContent = "Score: 0/0";
            timeLabel.textContent = "Time: 00:00";
            questionNumberLabel.textContent = "Question: 1";

            startButton.classList.remove("hidden");
            stopButton.classList.add("hidden");
            enterButton.classList.add("hidden");
            answerInput.classList.add("hidden");
            scoreLabel.classList.add("hidden");
            timeLabel.classList.add("hidden");
            questionNumberLabel.classList.add("hidden");
            answersTable.classList.add("hidden"); // ซ่อนตารางเมื่อหยุดเกม
            clearInterval(timer);
        }

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
</body>
</html>
